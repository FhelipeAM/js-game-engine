loadedLevel = [{"type":"level","keys":{"size":[9999.9306640625,799.9306030273438],"img":"","LEntID":7797}},{"type":"weapon","keys":{"name":"emptyHands","type":"single","damage":0,"sndSet":[{"name":"attack","path":"./assets/snd/weapon/Gunshot2.ogg","loop":false,"vol":0.5}],"bulletSpeed":1,"range":100,"ammoCount":0,"ammoCountRes":0,"fireTime":2.2,"reloadTime":4}},{"type":"weapon","keys":{"name":"InstaKiller","type":"single","damage":999,"sndSet":[{"name":"attack","path":"./assets/snd/weapon/Gunshot2.ogg","loop":false,"vol":0.5}],"bulletSpeed":5,"range":150,"ammoCount":1,"ammoCountRes":0,"fireTime":15,"reloadTime":4}},{"type":"sentient","keys":{"movespeed":1,"ignoreGravity":false,"coll":[100,100],"solid":true,"weight":0.9,"mdl":"assets/img/testent8.png","docRefID":"player","pos":[182,686],"linkedTo":null,"linkedToOffset":[0,0],"aiEnabled":false,"infiniteAmmo":false,"oblivious":false,"notarget":false,"godMode":false,"health":10,"bulletSpeed":1,"weaponsName":"emptyHands","team":"allies"}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[100,100],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity32","pos":[560,700],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[300,100],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity68","pos":[660,600],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[100,30],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity277","pos":[1291.6363525390625,700],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[100,30],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity364","pos":[1107.6363525390625,594],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[100,30],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity532","pos":[1265,461],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":false,"coll":[30,420],"solid":true,"weight":40,"mdl":"#000000","docRefID":"Entity693","pos":[1390.4545288085938,375],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"trigger","keys":{"movespeed":1,"ignoreGravity":true,"coll":[200,10],"solid":false,"weight":1,"mdl":["",{}],"docRefID":"Trigg_hostiles","pos":[1428,403],"linkedTo":null,"linkedToOffset":[0,0],"type":["once"],"ignoreEntTypes":["bullet","uielem","origin"]}},{"type":"trigger","keys":{"movespeed":1,"ignoreGravity":true,"coll":[200,100],"solid":false,"weight":1,"mdl":["",{}],"docRefID":"trololo_trigger","pos":[662,700],"linkedTo":null,"linkedToOffset":[0,0],"type":["once"],"ignoreEntTypes":["bullet","uielem","origin"]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[10,100],"solid":true,"weight":100,"mdl":"#000000","docRefID":"trololo_door","pos":[959,600],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[200,30],"solid":true,"weight":100,"mdl":"#000000","docRefID":"platform_godown","pos":[1421.857177734375,421.42857360839844],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"origin","keys":{"movespeed":1,"ignoreGravity":true,"coll":[50,50],"solid":false,"weight":1,"mdl":["",{}],"docRefID":"trololo_spawner","pos":[843,705],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[260,30],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity2004","pos":[1660,619],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"origin","keys":{"movespeed":1,"ignoreGravity":true,"coll":[50,50],"solid":false,"weight":1,"mdl":["",{}],"docRefID":"phase2_hostile","pos":[2192,674],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"origin","keys":{"movespeed":1,"ignoreGravity":true,"coll":[50,50],"solid":false,"weight":1,"mdl":["",{}],"docRefID":"elevator_dest","pos":[1424.857177734375,800.1428527832031],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[330,30],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity3799","pos":[2038,606],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":false,"coll":[80,80],"solid":true,"weight":1,"mdl":"assets/img/testent5.png","docRefID":"Entity4602","pos":[2107,124],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[400,220],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity4665","pos":[2366.857177734375,583.4285583496094],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[10,300],"solid":true,"weight":40,"mdl":"#ffbb00","docRefID":"sacrifice_door","pos":[2927.666748046875,289.3333282470703],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"trigger","keys":{"movespeed":1,"ignoreGravity":true,"coll":[80,10],"solid":false,"weight":1,"mdl":["",{}],"docRefID":"sacrifice_trigger","pos":[2788,783],"linkedTo":null,"linkedToOffset":[0,0],"type":["once"],"ignoreEntTypes":["bullet","uielem","origin"]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[400,220],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity5647","pos":[2884.800048828125,583],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[10,400],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity5737","pos":[2916.666748046875,0],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[10,400],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity5796","pos":[2938.666748046875,0],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[100,10],"solid":true,"weight":40,"mdl":"#ffbb00","docRefID":"sacrificed_door_lock","pos":[2876,574],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[250,30],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity6720","pos":[1912,342.1999969482422],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[330,10],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity6745","pos":[2091,212],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[100,10],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity6757","pos":[2429,258],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[100,30],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity6813","pos":[2152,465.1999969482422],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[100,10],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity6836","pos":[2411,249],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[100,10],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity6848","pos":[2392.857177734375,240],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[100,10],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity6860","pos":[2372.857177734375,230],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[100,10],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity6872","pos":[2352.857177734375,221],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[100,30],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity7153","pos":[1753,275.1999969482422],"linkedTo":null,"linkedToOffset":[0,0]}},{"type":"entity","keys":{"movespeed":1,"ignoreGravity":true,"coll":[100,30],"solid":true,"weight":100,"mdl":"#000000","docRefID":"Entity7165","pos":[1912,195.1999969482422],"linkedTo":null,"linkedToOffset":[0,0]}}];

let LTPT = 0;

jumpForce = 150

main();

function main() {

    RemoveInput("shoot")

    RegisterInput(" ", "TPP", () => {
        
        if (timePassed < LTPT)
            return;

        player.Teleport([mousePos[0], mousePos[1]]);

        LTPT = timePassed + 200;
    });

    setup_trololo();

    let phase2Starter = GetEnt("Trigg_hostiles");
    phase2Starter.OverrideAction(() => Phase2());
    
    let phase3Starter = GetEnt("sacrifice_trigger");
    phase3Starter.OverrideAction((collider) => Phase3(collider));
}

function Phase2() {

    let platform = GetEnt("platform_godown");
    let platformDest = GetEnt("elevator_dest");
    platform.MoveTo(platformDest.pos, false);

    let spawnerRef = GetEnt("phase2_hostile");

    let ai = SpawnHostile(spawnerRef.pos);
}

function Phase3(collider) {

    if (collider == player)
        player.health = 0;

    let sacrificeDoor = GetEnt("sacrifice_door");
    let sacrificedDoorLock = GetEnt("sacrificed_door_lock");
    sacrificeDoor.MoveTo([sacrificeDoor.pos[0], sacrificeDoor.pos[1] - sacrificeDoor.coll[1]], false);
    sacrificedDoorLock.MoveTo([sacrificedDoorLock.pos[0]- sacrificedDoorLock.coll[0], sacrificedDoorLock.pos[1]], false);

    collider.Delete();
}

function setup_trololo() {
    let trololo = GetEnt("trololo_trigger");
    trololo.OverrideAction(async () => {
        let door = GetEnt("trololo_door");
        door.MoveTo([door.pos[0], door.pos[1] + door.coll[1]], false);

        let spawnerRef = GetEnt("trololo_spawner");

        await s(3);

        let ai = SpawnHostile(spawnerRef.pos);
    })
}

function SpawnHostile(sp) {
    let stubSEnt = new Sentient("Hostile" + entCount, sp, [100, 100], "assets/img/testent6.png", "axis", true);
    stubSEnt.infiniteAmmo = true;
    stubSEnt.GiveWeapon(GetWeaponByName("InstaKiller"));
    return stubSEnt;
}